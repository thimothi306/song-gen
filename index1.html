

<!DOCTYPE html>
<html lang="te">
<head>
  <meta charset="UTF-8" />
  <title>Song Sheet Generator (Telugu - A4)</title>

  <!-- Telugu-friendly font -->
  <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Noto+Sans+Telugu:wght@400;600&display=swap">
  <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@700&display=swap">

  <style>
    * {
      box-sizing: border-box;
    }

    body {
      margin: 0;
      padding: 0;
      font-family: "Noto Sans Telugu", system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      background: linear-gradient(135deg, #0f172a 0%, #1e3a8a 50%, #1e40af 100%);
      min-height: 100vh;
    }

    .app {
      max-width: 100%;
      margin: 0 auto;
      padding: 20px;
    }

    h1 {
      font-size: 40px;
      margin: 0 0 8px 0;
      color: #e0e7ff;
      font-weight: 800;
      text-shadow: 2px 2px 8px rgba(0,0,0,0.4);
      font-family: "Playfair Display", serif;
      letter-spacing: 1px;
    }

    .subtitle {
      font-size: 16px;
      color: #c7d2fe;
      margin-bottom: 24px;
      font-weight: 500;
      letter-spacing: 0.5px;
    }

    .container {
      display: grid;
      grid-template-columns: 1fr 1fr 1fr;
      gap: 24px;
      max-width: 100%;
    }

    @media (max-width: 1600px) {
      .container {
        grid-template-columns: 1fr 1fr;
      }
    }

    @media (max-width: 1000px) {
      .container {
        grid-template-columns: 1fr;
      }
    }

    .card {
      background: linear-gradient(135deg, #ffffff 0%, #f5f8ff 100%);
      border-radius: 20px;
      padding: 28px;
      box-shadow: 0 20px 50px rgba(0,0,0,0.12), 0 0 0 1px rgba(255,255,255,0.5);
      border: 1px solid rgba(199, 210, 254, 0.4);
      display: flex;
      flex-direction: column;
      height: fit-content;
    }

    .card.preview-card {
      height: auto;
    }

    .section {
      margin-bottom: 24px;
      padding-bottom: 24px;
      border-bottom: 2px solid #e0e7ff;
    }

    .section:last-child {
      border-bottom: none;
      margin-bottom: 0;
    }

    .section-title {
      font-size: 16px;
      font-weight: 800;
      color: #1e3a8a;
      margin-bottom: 14px;
      display: flex;
      align-items: center;
      gap: 10px;
      letter-spacing: 0.5px;
    }

    .form-group {
      margin-bottom: 14px;
    }

    label {
      font-size: 14px;
      font-weight: 700;
      color: #1e3a8a;
      display: block;
      margin-bottom: 8px;
      letter-spacing: 0.3px;
    }

    input[type="text"],
    textarea,
    select,
    input[type="number"] {
      width: 100%;
      border-radius: 12px;
      border: 2px solid #c7d2fe;
      padding: 12px 14px;
      font-size: 14px;
      font-family: inherit;
      background: #fafbff;
      color: #1e3a8a;
      transition: all 0.3s ease;
    }

    input[type="text"]:focus,
    textarea:focus,
    select:focus,
    input[type="number"]:focus {
      outline: none;
      border-color: #1e40af;
      box-shadow: 0 0 0 4px rgba(30, 64, 175, 0.1);
      background: #ffffff;
    }

    textarea {
      min-height: 140px;
      resize: vertical;
    }

    .row {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 14px;
    }

    button {
      border: none;
      border-radius: 12px;
      padding: 14px 24px;
      font-size: 15px;
      font-weight: 700;
      cursor: pointer;
      background: linear-gradient(135deg, #1e40af 0%, #1e3a8a 100%);
      color: white;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
      transition: all 0.3s ease;
      box-shadow: 0 4px 15px rgba(30, 64, 175, 0.3);
      font-weight: 600;
    }

    button:hover {
      transform: translateY(-2px);
      box-shadow: 0 6px 20px rgba(30, 64, 175, 0.4);
    }

    button:active {
      transform: scale(0.98);
    }

    .btn-full {
      width: 100%;
    }

    .btn-success {
      background: linear-gradient(135deg, #10b981 0%, #059669 100%);
    }

    .btn-success:hover {
      box-shadow: 0 6px 20px rgba(16, 185, 129, 0.4);
    }

    .btn-warning {
      background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%);
      padding: 10px 16px;
      font-size: 13px;
    }

    .btn-danger {
      background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);
      padding: 10px 16px;
      font-size: 13px;
    }

    .btn-danger:hover {
      box-shadow: 0 6px 20px rgba(239, 68, 68, 0.4);
    }

    .hint {
      font-size: 13px;
      color: #3730a3;
      background: rgba(167, 139, 250, 0.1);
      padding: 14px;
      border-radius: 10px;
      border-left: 4px solid #6366f1;
      margin-top: 10px;
      line-height: 1.6;
    }

    .preview-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 16px;
      font-weight: 700;
      color: #c7d2fe;
      font-size: 16px;
    }

    .preview-box {
      border-radius: 16px;
      background: linear-gradient(135deg, #1a1f35 0%, #0f172a 100%);
      padding: 20px;
      overflow: auto;
      max-height: 85vh;
      border: 2px solid rgba(199, 210, 254, 0.4);
      box-shadow: inset 0 2px 8px rgba(0,0,0,0.3);
    }

    @page {
      size: A4;
      margin: 0;
      padding: 0;
    }

    @media print {
      body {
        background: white !important;
        padding: 0 !important;
        margin: 0 !important;
      }
      .no-print {
        display: none !important;
      }
      .app {
        padding: 0 !important;
        max-width: 100% !important;
        margin: 0 !important;
      }
      .print-container {
        display: block !important;
        max-width: 100% !important;
        padding: 0 !important;
        margin: 0 !important;
      }
      .preview-box {
        border: none !important;
        padding: 0 !important;
        max-height: none !important;
        overflow: visible !important;
        background: white !important;
        box-shadow: none !important;
      }
      .sheet {
        box-shadow: none !important;
        margin: 0 !important;
        padding: 6mm !important;
        page-break-after: always !important;
        border: none !important;
      }
      #sheetsContainerPrint {
        margin: 0 !important;
        padding: 0 !important;
      }
    }

    .print-container {
      display: none;
      margin: 0;
      padding: 0;
    }

    .sheet {
      background: white;
      padding: 6mm;
      margin-bottom: 16px;
      min-height: 277mm;
      column-gap: 6mm;
      border-radius: 2px;
      border: 1px solid #e0e7ff;
      color: #000 !important;
    }

    .columns-2 {
      column-count: 2;
      column-fill: auto;
    }

    .columns-1 {
      column-count: 1;
    }

    .song {
      margin-bottom: 6px;
      padding-bottom: 4px;
      border-bottom: 1px solid #d1d5db;
      break-inside: auto;
      color: #000 !important;
    }

    .song-title {
      font-size: 14px;
      font-weight: 800;
      margin-bottom: 3px;
      color: #000 !important;
      break-inside: avoid;
    }

    .song-number {
      font-size: 13px;
      color: #000 !important;
      margin-right: 4px;
      font-weight: 900;
    }

    .song-body {
      font-size: 12px;
      line-height: 1.35;
      white-space: pre-line;
      color: #000 !important;
      font-weight: 500;
    }

    .church-header {
      text-align: center;
      margin-bottom: 12px;
      padding-bottom: 8px;
      border-bottom: 3px solid #000;
      font-size: 17px;
      font-weight: 900;
      color: #000 !important;
      column-span: all;
    }

    .stat-box {
      background: linear-gradient(135deg, rgba(30, 64, 175, 0.1) 0%, rgba(99, 102, 241, 0.1) 100%);
      border-left: 4px solid #1e40af;
      padding: 14px;
      border-radius: 10px;
      font-size: 14px;
      color: #1e3a8a;
      font-weight: 600;
      margin-top: 14px;
    }

    .action-buttons {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 12px;
      margin-top: 20px;
    }

    .action-buttons button {
      font-size: 14px;
      padding: 12px;
    }

    /* SONGS LIST STYLING */
    .songs-list {
      display: grid;
      grid-template-columns: 1fr;
      gap: 12px;
      max-height: 45vh;
      overflow-y: auto;
      padding: 4px;
    }

    .song-item {
      padding: 14px;
      background: linear-gradient(135deg, #ffffff 0%, #f9fafb 100%);
      border: 2px solid #e5e7eb;
      border-radius: 12px;
      cursor: grab;
      transition: all 0.3s ease;
      user-select: none;
      display: flex;
      flex-direction: column;
      gap: 10px;
    }

    .song-item:hover {
      border-color: #1e40af;
      box-shadow: 0 4px 12px rgba(30, 64, 175, 0.2);
      transform: translateY(-2px);
      background: linear-gradient(135deg, #ffffff 0%, #f0f4ff 100%);
    }

    .song-item.dragging {
      opacity: 0.6;
      cursor: grabbing;
    }

    .song-item-header {
      display: flex;
      justify-content: space-between;
      align-items: flex-start;
      gap: 10px;
    }

    .song-item-number {
      background: linear-gradient(135deg, #1e40af 0%, #1e3a8a 100%);
      color: white;
      width: 28px;
      height: 28px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 12px;
      font-weight: 900;
      flex-shrink: 0;
      box-shadow: 0 2px 8px rgba(30, 64, 175, 0.3);
    }

    .song-item-title {
      flex: 1;
      font-weight: 700;
      color: #1e3a8a;
      font-size: 14px;
      line-height: 1.3;
      word-break: break-word;
    }

    .song-item-actions {
      display: flex;
      gap: 6px;
      flex-wrap: wrap;
    }

    .empty-songs {
      padding: 30px 20px;
      text-align: center;
      color: #9ca3af;
      font-size: 14px;
      font-weight: 500;
    }

    .drag-handle {
      cursor: grab;
      color: #818cf8;
      font-size: 18px;
      flex-shrink: 0;
    }

    /* MODAL STYLES */
    .modal {
      display: none;
      position: fixed;
      z-index: 1000;
      left: 0;
      top: 0;
      width: 100%;
      height: 100%;
      background-color: rgba(0, 0, 0, 0.5);
      animation: fadeIn 0.3s ease;
    }

    @keyframes fadeIn {
      from { opacity: 0; }
      to { opacity: 1; }
    }

    .modal-content {
      background: linear-gradient(135deg, #ffffff 0%, #f5f8ff 100%);
      margin: 50px auto;
      padding: 32px;
      border-radius: 20px;
      width: 90%;
      max-width: 500px;
      box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
      animation: slideUp 0.3s ease;
    }

    @keyframes slideUp {
      from {
        transform: translateY(30px);
        opacity: 0;
      }
      to {
        transform: translateY(0);
        opacity: 1;
      }
    }

    .modal-header {
      font-size: 20px;
      font-weight: 800;
      color: #1e3a8a;
      margin-bottom: 20px;
    }

    .modal-buttons {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 12px;
      margin-top: 20px;
    }

    .close {
      color: #999;
      float: right;
      font-size: 28px;
      font-weight: bold;
      cursor: pointer;
      transition: color 0.3s;
    }

    .close:hover {
      color: #1e3a8a;
    }

    .wrapper {
      display: flex;
      gap: 24px;
    }

    .left-right-section {
      flex: 1;
      display: flex;
      flex-direction: column;
      gap: 24px;
    }
  </style>
</head>
<body>
  <div class="app">
    <div class="no-print">
      <h1>‚ú® Song Sheet Generator</h1>
      <div class="subtitle">
        Telugu ¬∑ Lyrics only ¬∑ A4 ¬∑ Auto layout (2 columns) ¬∑ Spiritual Collection
      </div>

      <div class="card">
        <div class="row">
          <div style="flex:1 1 200px;">
            <label for="churchName">‚õ™ Church Name (Optional):</label>
          </div>
          <input type="text" id="churchName" placeholder="e.g., Living Hope Church" style="flex:1 1 250px; padding: 8px 12px; border-radius: 10px; border: 2px solid #c7d2fe; font-size: 14px;">
        </div>

        <div class="row" style="margin-top: 12px;">
          <div style="flex:1 1 200px;">
            <label for="rawInput">‚úçÔ∏è Paste all songs here:</label>
          </div>
        </div>

        <textarea id="rawInput" placeholder="‡∞â‡∞¶‡∞æ‡∞π‡∞∞‡∞£:

Yesu Naa Rakshakudu
‡∞≤‡±à‡∞®‡±ç 1
‡∞≤‡±à‡∞®‡±ç 2
‡∞≤‡±à‡∞®‡±ç 3

---
Naa Prabhu Naa Devudu
‡∞≤‡±à‡∞®‡±ç 1
‡∞≤‡±à‡∞®‡±ç 2
"></textarea>

        <div class="hint">
          üëâ ‡∞™‡±ç‡∞∞‡∞§‡∞ø ‡∞™‡∞æ‡∞ü ‡∞Æ‡∞ß‡±ç‡∞Ø‡∞≤‡±ã ‡∞í‡∞ï ‡∞≤‡±à‡∞®‡±ç‚Äå‡∞≤‡±ã <strong>---</strong> (‡∞Æ‡±Ç‡∞°‡±Å ‡∞°‡∞æ‡∞∑‡±ç‚Äå‡∞≤‡±Å) ‡∞™‡±Ü‡∞ü‡±ç‡∞ü‡∞Ç‡∞°‡∞ø.<br />
          üëâ ‡∞™‡±ç‡∞∞‡∞§‡∞ø ‡∞¨‡±ç‡∞≤‡∞æ‡∞ï‡±ç‚Äå‡∞≤‡±ã <strong>‡∞Æ‡±ä‡∞¶‡∞ü‡∞ø ‡∞≤‡±à‡∞®‡±ç ‡∞™‡∞æ‡∞ü ‡∞ü‡±à‡∞ü‡∞ø‡∞≤‡±ç</strong> ‡∞ó‡∞æ ‡∞§‡±Ä‡∞∏‡±Å‡∞ï‡±Å‡∞Ç‡∞ü‡∞æ‡∞Ç.
        </div>

        <div class="row" style="margin-top:10px;">
          <div class="controls-inline">
            <label for="fontSize">üìè Font size:</label>
            <select id="fontSize">
              <option value="11">Extra Small (11)</option>
              <option value="12">Small (12)</option>
              <option value="13" selected>Normal (13)</option>
              <option value="14">Large (14)</option>
              <option value="15">Extra Large (15)</option>
              <option value="16">XXL (16)</option>
              <option value="17">XXXL (17)</option>
              <option value="18">Giant (18)</option>
            </select>

            <label for="columns">üìÑ Columns:</label>
            <select id="columns">
              <option value="2" selected>2 columns</option>
              <option value="1">1 column</option>
            </select>
          </div>

          <div style="margin-left:auto;">
            <button id="generateBtn">
              ‚öôÔ∏è Generate Sheets
            </button>
          </div>
        </div>

        <div style="margin-top: 16px; padding-top: 16px; border-top: 2px solid #c7d2fe;">
          <div style="margin-bottom: 12px;">
            <label style="font-weight: 700; color: #1e3a8a; font-size: 15px;">üìã Auto-fit Pages (Optional)</label>
            <div class="hint" style="margin-top: 6px;">
              Enable this to automatically adjust font sizes based on total songs and pages. Font size dropdown will be disabled.
            </div>
          </div>

          <div class="row">
            <label style="display: flex; align-items: center; gap: 8px; cursor: pointer;">
              <input type="checkbox" id="autoFitToggle" style="width: 18px; height: 18px; cursor: pointer;">
              <span style="color: #1e3a8a; font-weight: 500;">Enable Auto-fit</span>
            </label>
          </div>

          <div class="row" style="margin-top: 12px; gap: 20px; display: none;" id="autoFitOptions">
            <div style="flex: 1 1 200px;">
              <label for="totalSongs">Total Songs:</label>
              <input type="number" id="totalSongs" min="1" max="100" value="20" style="width: 100%; padding: 8px 10px; border-radius: 10px; border: 2px solid #c7d2fe;">
            </div>

            <div style="flex: 1 1 200px;">
              <label for="totalPages">Total Pages:</label>
              <select id="totalPages" style="width: 100%; padding: 8px 10px; border-radius: 10px; border: 2px solid #c7d2fe;">
                <option value="1">1 Page (Front only)</option>
                <option value="2" selected>2 Pages (Front & Back)</option>
                <option value="3">3 Pages</option>
                <option value="4">4 Pages</option>
                <option value="5">5 Pages</option>
              </select>
            </div>

            <div style="flex: 1 1 200px;">
              <label for="sheetsPerPage">Sheets per Page:</label>
              <select id="sheetsPerPage" style="width: 100%; padding: 8px 10px; border-radius: 10px; border: 2px solid #c7d2fe;">
                <option value="1" selected>1 Sheet per Page</option>
                <option value="2">2 Sheets per Page</option>
              </select>
            </div>
          </div>

          <div style="margin-top: 12px; padding: 12px; background: rgba(30, 64, 175, 0.08); border-radius: 8px; border-left: 4px solid #1e40af; display: none;" id="autoFitInfo">
            <div style="font-size: 13px; color: #1e3a8a; font-weight: 500;">
              üìä <span id="songCountDisplay"></span> songs will fit in <span id="pageCountDisplay"></span> pages ‚Ä¢ Font size: <span id="fontSizeDisplay" style="font-weight: 700; color: #1e40af;"></span>px
            </div>
          </div>
        </div>
      </div>
    </div>

    <div class="card preview-wrapper">
      <div class="preview-header no-print">
        <div>üîç Preview (what will be printed on A4)</div>
        <div class="controls-inline">
          <button onclick="window.print()">üñ®Ô∏è Print</button>
        </div>
      </div>

      <div class="preview-box">
        <div id="sheetsContainer">
          <!-- Generated content goes here -->
          <div class="sheet columns-2" id="emptyState">
            <div style="font-size:13px; color:#a5b4fc;">
              ‡∞™‡±à‡∞® ‡∞â‡∞®‡±ç‡∞® ‡∞¨‡∞æ‡∞ï‡±ç‡∞∏‡±ç‚Äå‡∞≤‡±ã ‡∞™‡∞æ‡∞ü‡∞≤‡±Å ‡∞™‡±á‡∞∏‡±ç‡∞ü‡±ç ‡∞ö‡±á‡∞∏‡∞ø <b>"Generate Sheets"</b> ‡∞®‡±ä‡∞ï‡±ç‡∞ï‡∞Ç‡∞°‡∞ø.  
              ‡∞á‡∞ï‡±ç‡∞ï‡∞° ‡∞™‡±ç‡∞∞‡∞ø‡∞Ç‡∞ü‡±ç ‡∞Ö‡∞µ‡±Å‡∞ü‡±ç ‡∞é‡∞≤‡∞æ ‡∞µ‡∞∏‡±ç‡∞§‡±Å‡∞Ç‡∞¶‡±ã ‡∞ö‡±Ç‡∞™‡∞ø‡∞∏‡±ç‡∞§‡±Å‡∞Ç‡∞¶‡∞ø.
            </div>
          </div>
        </div>
      </div>
    </div>

  </div>

  <script>
    const rawInput = document.getElementById("rawInput");
    const churchName = document.getElementById("churchName");
    const fontSizeSelect = document.getElementById("fontSize");
    const columnsSelect = document.getElementById("columns");
    const generateBtn = document.getElementById("generateBtn");
    const sheetsContainer = document.getElementById("sheetsContainer");
    const emptyState = document.getElementById("emptyState");
    
    // Auto-fit variables
    const autoFitToggle = document.getElementById("autoFitToggle");
    const autoFitOptions = document.getElementById("autoFitOptions");
    const totalSongsInput = document.getElementById("totalSongs");
    const totalPagesSelect = document.getElementById("totalPages");
    const sheetsPerPageSelect = document.getElementById("sheetsPerPage");

    // Toggle auto-fit options visibility
    autoFitToggle.addEventListener("change", () => {
      autoFitOptions.style.display = autoFitToggle.checked ? "flex" : "none";
      fontSizeSelect.disabled = autoFitToggle.checked;
      if (rawInput.value.trim()) {
        generateSheets();
        updateAutoFitInfo();
      }
    });

    // Update on auto-fit value changes
    totalSongsInput.addEventListener("change", () => {
      if (rawInput.value.trim()) {
        generateSheets();
        updateAutoFitInfo();
      }
    });
    totalPagesSelect.addEventListener("change", () => {
      if (rawInput.value.trim()) {
        generateSheets();
        updateAutoFitInfo();
      }
    });
    sheetsPerPageSelect.addEventListener("change", () => {
      if (rawInput.value.trim()) {
        generateSheets();
        updateAutoFitInfo();
      }
    });

    function updateAutoFitInfo() {
      const autoFitInfo = document.getElementById("autoFitInfo");
      if (!autoFitToggle.checked) {
        autoFitInfo.style.display = "none";
        return;
      }

      const text = rawInput.value.trim();
      if (!text) return;

      const rawSongs = text.split(/\n-{3,}\n/g).filter(s => s.trim().length > 0);
      const actualSongCount = rawSongs.length;
      const totalPages = parseInt(totalPagesSelect.value, 10) || 2;
      const sheetsPerPage = parseInt(sheetsPerPageSelect.value, 10) || 1;
      const totalSheets = totalPages * sheetsPerPage;
      const songsPerSheet = Math.ceil(actualSongCount / totalSheets);
      const fontSize = calculateAutoFitFontSize(actualSongCount);

      document.getElementById("songCountDisplay").textContent = actualSongCount;
      document.getElementById("pageCountDisplay").textContent = totalSheets + " sheets";
      document.getElementById("fontSizeDisplay").textContent = fontSize;

      autoFitInfo.style.display = "block";
    }

    function calculateAutoFitFontSize(actualSongCount) {
      const totalPages = parseInt(totalPagesSelect.value, 10) || 2;
      const sheetsPerPage = parseInt(sheetsPerPageSelect.value, 10) || 1;
      
      // Total A4 sheets = physical pages √ó sheets per page
      const totalSheets = totalPages * sheetsPerPage;
      
      // ALL songs must fit in the selected sheets
      const songsPerSheet = actualSongCount / totalSheets;
      
      // Aggressive font sizing to fit ALL songs
      // More songs = much smaller font
      let fontSize = 13; // default
      
      if (songsPerSheet > 50) {
        fontSize = 8;
      } else if (songsPerSheet > 40) {
        fontSize = 9;
      } else if (songsPerSheet > 30) {
        fontSize = 10;
      } else if (songsPerSheet > 25) {
        fontSize = 11;
      } else if (songsPerSheet > 20) {
        fontSize = 12;
      } else if (songsPerSheet > 16) {
        fontSize = 13;
      } else if (songsPerSheet > 12) {
        fontSize = 14;
      } else if (songsPerSheet > 10) {
        fontSize = 15;
      } else if (songsPerSheet > 8) {
        fontSize = 16;
      } else if (songsPerSheet > 6) {
        fontSize = 17;
      } else if (songsPerSheet > 4) {
        fontSize = 18;
      } else {
        fontSize = 20;
      }
      
      return fontSize;
    }

    function clearSheets() {
      while (sheetsContainer.firstChild) {
        sheetsContainer.removeChild(sheetsContainer.firstChild);
      }
    }

    function generateSheets() {
      const text = rawInput.value.trim();
      clearSheets();

      if (!text) {
        sheetsContainer.appendChild(emptyState);
        return;
      }

      // Songs are separated by a line containing --- (3 or more dashes)
      const rawSongs = text.split(/\n-{3,}\n/g).filter(s => s.trim().length > 0);
      const actualSongCount = rawSongs.length;

      let fontSize = parseInt(fontSizeSelect.value, 10) || 13;
      let totalPages = 1;
      let sheetsPerPage = 1;
      
      // Use auto-calculated font size if enabled
      if (autoFitToggle.checked) {
        totalPages = parseInt(totalPagesSelect.value, 10) || 2;
        sheetsPerPage = parseInt(sheetsPerPageSelect.value, 10) || 1;
        fontSize = calculateAutoFitFontSize(actualSongCount);
      }
      
      const columns = columnsSelect.value === "1" ? "columns-1" : "columns-2";
      const churchNameText = churchName.value.trim();

      // Total A4 sheets = physical pages √ó sheets per page
      const totalSheets = totalPages * sheetsPerPage;
      
      // Calculate songs per sheet
      const songsPerSheet = Math.ceil(actualSongCount / totalSheets);

      // Create multiple A4 sheets
      for (let sheetNum = 0; sheetNum < totalSheets; sheetNum++) {
        const sheet = document.createElement("div");
        sheet.className = "sheet " + columns;
        sheet.style.fontSize = fontSize + "px";

        // Add church name header if provided
        if (churchNameText) {
          const headerEl = document.createElement("div");
          headerEl.className = "church-header";
          headerEl.textContent = churchNameText;
          sheet.appendChild(headerEl);
        }

        // Calculate song range for this sheet
        const startIndex = sheetNum * songsPerSheet;
        const endIndex = Math.min(startIndex + songsPerSheet, actualSongCount);

        // Add songs to this sheet
        for (let i = startIndex; i < endIndex; i++) {
          const block = rawSongs[i];
          const trimmed = block.trim();
          if (!trimmed) continue;

          const lines = trimmed.split("\n").map(l => l.trim());
          if (lines.length === 0) continue;

          const title = lines[0];
          const bodyLines = lines.slice(1).join("\n");

          const songEl = document.createElement("div");
          songEl.className = "song";

          const titleEl = document.createElement("div");
          titleEl.className = "song-title";

          const numberSpan = document.createElement("span");
          numberSpan.className = "song-number";
          numberSpan.textContent = (i + 1) + ".";

          const titleSpan = document.createElement("span");
          titleSpan.textContent = " " + title;

          titleEl.appendChild(numberSpan);
          titleEl.appendChild(titleSpan);

          const bodyEl = document.createElement("div");
          bodyEl.className = "song-body";
          bodyEl.style.fontSize = fontSize - 1 + "px";
          bodyEl.textContent = bodyLines;

          songEl.appendChild(titleEl);
          songEl.appendChild(bodyEl);

          sheet.appendChild(songEl);
        }

        sheetsContainer.appendChild(sheet);
      }
    }

    generateBtn.addEventListener("click", () => {
      generateSheets();
      updateAutoFitInfo();
    });

    // Optional: live update on change of font/columns
    fontSizeSelect.addEventListener("change", () => {
      if (!autoFitToggle.checked && rawInput.value.trim()) generateSheets();
    });
    columnsSelect.addEventListener("change", () => {
      if (rawInput.value.trim()) {
        generateSheets();
        updateAutoFitInfo();
      }
    });
    churchName.addEventListener("change", () => {
      if (rawInput.value.trim()) generateSheets();
    });
    
    // Update info when user pastes songs
    rawInput.addEventListener("input", () => {
      updateAutoFitInfo();
    });
  </script>
</body>
</html>


